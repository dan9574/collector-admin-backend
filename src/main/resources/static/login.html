<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>测试登录</title>
    <style>
        :root {
            --blue: #1677ff;
            --blue-hover: #0f68e6;
            --text: #1f2328;
            --muted: #57606a;
            --card-bg: #fff;
            --bg: #f6f8fa;
            --danger: #d14343;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,Segoe UI Emoji,Segoe UI Symbol;
            color: var(--text);
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        .card {
            width: 100%;
            max-width: 420px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            padding: 28px;
        }
        h2 { margin: 0 0 18px; font-size: 22px; }
        .muted { color: var(--muted); font-size: 13px; margin-bottom: 18px; }
        .field { margin-bottom: 14px; }
        label { display: block; margin-bottom: 6px; font-size: 13px; color: var(--muted); }
        input {
            width: 100%; padding: 10px 12px; border-radius: 10px;
            border: 1px solid #d0d7de; outline: none; font-size: 14px;
            transition: border-color .15s, box-shadow .15s;
            background: #fff;
        }
        input:focus { border-color: var(--blue); box-shadow: 0 0 0 3px rgba(22,119,255,.15); }
        .btn {
            width: 100%; padding: 10px 14px; border: none; border-radius: 10px;
            background: var(--blue); color: #fff; font-size: 15px; cursor: pointer;
            transition: background .15s, transform .02s;
        }
        .btn:hover { background: var(--blue-hover); }
        .btn:active { transform: translateY(1px); }
        .btn[disabled] { opacity: .6; cursor: not-allowed; }
        .error {
            display: none; margin: 12px 0 0; padding: 10px 12px; border-radius: 10px;
            background: #fdeeee; color: var(--danger); border: 1px solid #f5c2c2; font-size: 13px;
        }
        .welcome {
            display: none; /* 登录成功后显示 */
            text-align: center;
        }
        .welcome h3 { font-size: 24px; margin: 0 0 8px; }
        .welcome p { color: var(--muted); margin: 0; }
    </style>
</head>
<body>
<div class="card" id="card-login">
    <h2>测试登录</h2>
    <p class="muted">请输入账号与密码</p>

    <div class="field">
        <label for="username">用户名</label>
        <input id="username" type="text" placeholder="例如：admin" autocomplete="username" />
    </div>

    <div class="field">
        <label for="password">密码</label>
        <input id="password" type="password" placeholder="请输入密码" autocomplete="current-password" />
    </div>

    <button class="btn" id="btnLogin">登录</button>
    <div class="error" id="errBox">用户名或密码错误</div>
</div>

<div class="card welcome" id="card-welcome">
    <h3 id="hello">你好，欢迎！</h3>
    <p>你已成功登录。</p>
</div>

<script>
    const $ = (sel) => document.querySelector(sel);
    const btn = $('#btnLogin');
    const errBox = $('#errBox');
    const cardLogin = $('#card-login');
    const cardWelcome = $('#card-welcome');
    const hello = $('#hello');

    function setLoading(loading) {
        btn.disabled = loading;
        btn.textContent = loading ? '登录中…' : '登录';
    }

    async function login(username, password) {
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',       // ★ 关键：跨端口必加；同源加了也没坏处
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        if (!res.ok || !data.success) {
            throw new Error(data.message || '登录失败');
        }

        // 不再读取/保存 token！
        // 登陆后直接跳转或加载个人信息
        location.hash = '#/profile';
    }


    // 点击登录
    btn.addEventListener('click', login);
    // 回车提交
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') login();
    });
</script>
</body>
</html>
